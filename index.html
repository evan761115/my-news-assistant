<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾¤ç¾¤6è™Ÿ - ETé™å®šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        :root {
            --et-vibrant-1: #6366f1;
            --et-vibrant-2: #a855f7;
            --et-bg: #fdfdfd;
            --et-card-bg: #ffffff;
        }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--et-bg); 
            background-image: radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.05) 0%, transparent 25%),
                              radial-gradient(circle at 100% 100%, rgba(168, 85, 247, 0.05) 0%, transparent 25%);
        }
        .vibrant-border {
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899);
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }
        .logo-box {
            background: linear-gradient(135deg, #818cf8 0%, #a855f7 100%);
            box-shadow: 0 8px 20px -4px rgba(129, 140, 248, 0.5);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .logo-box:hover {
            transform: scale(1.05) rotate(-3deg);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }
        .input-box { 
            border: 2px solid #f1f5f9;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .input-box:focus {
            border-color: var(--et-vibrant-1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            outline: none;
        }
        .btn-vibrant {
            background: linear-gradient(135deg, var(--et-vibrant-1), var(--et-vibrant-2));
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-vibrant:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3);
            filter: brightness(1.1);
        }
        .tab-btn {
            position: relative;
            padding: 12px 16px;
            font-weight: 700;
            color: #94a3b8;
            transition: all 0.3s;
        }
        .tab-btn.active {
            color: var(--et-vibrant-1);
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: var(--et-vibrant-1);
            border-radius: 99px;
        }
        pre { white-space: pre-wrap; word-wrap: break-word; font-family: inherit; }
        #toast {
            visibility: hidden; min-width: 250px; background-color: #1e293b; color: #fff; text-align: center;
            border-radius: 12px; padding: 16px; position: fixed; z-index: 50; left: 50%; bottom: 30px;
            transform: translateX(-50%); opacity: 0; transition: all 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }
        .loading-dots div {
            width: 8px; height: 8px; background: var(--et-vibrant-1); border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }
        .loading-dots div:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots div:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body class="pt-10 p-4 md:p-8 min-h-screen text-slate-700">
    <div class="vibrant-border"></div>

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div class="flex items-center gap-5">
                <!-- ç¾åŒ–å¾Œçš„ Logo å€å¡Š -->
                <div class="logo-box w-16 h-16 rounded-2xl flex items-center justify-center text-white text-3xl font-black italic tracking-tighter">
                    ET
                </div>
                <div>
                    <h1 class="text-4xl font-black tracking-tight text-slate-800 leading-none mb-2">ç¾¤ç¾¤6è™Ÿ</h1>
                    <p class="text-sm font-bold text-slate-400">æ–°èé€Ÿå¯«</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 bg-white p-2.5 rounded-2xl border border-slate-100 card-shadow">
                <input type="password" id="apiKeyInput" class="input-box p-2 text-sm w-48 border-none bg-slate-50" placeholder="Gemini API Key">
                <button onclick="saveApiKey()" class="bg-slate-800 hover:bg-black text-white px-4 py-2 rounded-xl text-sm font-bold transition">å„²å­˜</button>
                <span id="keyStatus" class="text-xs text-rose-500 font-bold px-2">æœªè¨­å®š</span>
            </div>
        </header>

        <nav class="flex overflow-x-auto gap-4 mb-8 no-scrollbar">
            <button class="tab-btn active" onclick="switchMode('news_gen', this)">é‡é»è½‰æ–°è</button>
            <button class="tab-btn" onclick="switchMode('news_rewrite', this)">æ–°èæ”¹å¯«</button>
            <button class="tab-btn" onclick="switchMode('pr_rewrite', this)">é€šç¨¿æ”¹å¯«</button>
            <button class="tab-btn" onclick="switchMode('interview', this)">æ·±åº¦è¨ªç¶±</button>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- è¼¸å…¥å€ -->
            <div class="bg-white rounded-[2rem] p-8 card-shadow flex flex-col space-y-6 border border-slate-50">
                <div class="flex-1">
                    <label id="inputLabel" class="block text-xs font-black text-indigo-500 mb-3 tracking-widest uppercase">è¼¸å…¥äº‹ä»¶é‡é»æˆ–ç¤¾ç¾¤è²¼æ–‡</label>
                    <textarea id="userInput" class="input-box w-full h-80 p-5 text-slate-600 leading-relaxed bg-slate-50/50" placeholder="è«‹è¼¸å…¥å…§å®¹..."></textarea>
                </div>

                <div id="wordCountControl" class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-50 p-3 rounded-2xl">
                        <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wider">æœŸæœ›ç¸½å­—æ•¸</label>
                        <select id="targetLength" class="w-full bg-transparent font-bold text-slate-700 outline-none cursor-pointer">
                            <option value="ç´„ 500 å­—">ç´„ 500 å­—</option>
                            <option value="ç´„ 800 å­—">ç´„ 800 å­—</option>
                            <option value="ç´„ 1200 å­—">ç´„ 1200 å­—</option>
                        </select>
                    </div>
                    <div class="bg-slate-50 p-3 rounded-2xl">
                        <label class="block text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-wider">åˆ†æ®µæ•¸é‡</label>
                        <select id="targetParagraphs" class="w-full bg-transparent font-bold text-slate-700 outline-none cursor-pointer">
                            <option value="3 æ®µ">3 æ®µ</option>
                            <option value="5 æ®µ">5 æ®µ</option>
                            <option value="8 æ®µ">8 æ®µ</option>
                        </select>
                    </div>
                </div>

                <button id="runBtn" class="btn-vibrant w-full py-5 rounded-2xl font-black text-xl tracking-[0.2em] shadow-xl uppercase">å•Ÿå‹•ç”Ÿæˆå¼•æ“</button>
            </div>

            <!-- è¼¸å‡ºå€ -->
            <div class="bg-white rounded-[2rem] p-8 card-shadow flex flex-col relative min-h-[600px] border border-slate-50">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                        <span class="text-sm font-black text-slate-400 tracking-wider uppercase">ç”Ÿæˆçµæœè¼¸å‡º</span>
                    </div>
                    <button onclick="copyResult()" class="text-xs font-bold text-indigo-500 bg-indigo-50 hover:bg-indigo-100 px-4 py-2 rounded-xl transition">ä¸€éµè¤‡è£½å…¨æ–‡</button>
                </div>
                
                <div id="loading" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white/80 backdrop-blur-sm z-10 rounded-[2rem]">
                    <div class="loading-dots flex gap-2 mb-4">
                        <div></div><div></div><div></div>
                    </div>
                    <p class="text-indigo-600 font-black animate-pulse">æ­£åœ¨ç‚ºæ‚¨ç·¨å¯«å ±å°â‹¯</p>
                </div>

                <div id="output" class="flex-1 overflow-y-auto text-slate-800 leading-loose text-lg scroll-smooth">
                    <div class="flex flex-col items-center justify-center h-full opacity-20 py-20">
                        <svg class="w-20 h-20 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10l4 4v10a2 2 0 01-2 2zM14 3v5h5M7 16h10M7 12h10M7 8h2"></path></svg>
                        <p class="font-bold">ç­‰å¾…æ‚¨çš„æŒ‡ä»¤</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast">æç¤ºè¨Šæ¯</div>

    <script>
        let currentMode = 'news_gen';

        window.onload = function() {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
                document.getElementById('keyStatus').innerText = 'âœ… å°±ç·’';
                document.getElementById('keyStatus').className = 'text-xs text-indigo-600 font-bold px-2';
            }
        };

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                document.getElementById('keyStatus').innerText = 'âœ… å·²å„²å­˜';
                document.getElementById('keyStatus').className = 'text-xs text-indigo-600 font-bold px-2';
                showToast('API Key å·²å®‰å…¨å„²å­˜ï¼');
            } else {
                localStorage.removeItem('gemini_api_key');
                document.getElementById('keyStatus').innerText = 'æœªè¨­å®š';
                document.getElementById('keyStatus').className = 'text-xs text-rose-500 font-bold px-2';
            }
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.innerText = message;
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function switchMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const label = document.getElementById('inputLabel');
            const userInput = document.getElementById('userInput');
            const wordCtrl = document.getElementById('wordCountControl');
            
            if (mode === 'interview') {
                wordCtrl.classList.add('hidden');
            } else {
                wordCtrl.classList.remove('hidden');
            }

            switch(mode) {
                case 'news_gen': label.innerText = 'è¼¸å…¥äº‹ä»¶é‡é»æˆ–ç¤¾ç¾¤è²¼æ–‡'; userInput.placeholder = 'è«‹æä¾›äººäº‹æ™‚åœ°ç‰©...'; break;
                case 'news_rewrite': label.innerText = 'è²¼ä¸Šæ–°èå…¨æ–‡æˆ–é€£çµ'; userInput.placeholder = 'è²¼ä¸Šè¦æ”¹å¯«çš„å…§å®¹...'; break;
                case 'pr_rewrite': label.innerText = 'è²¼ä¸Šå…¬é—œæ–°èç¨¿ä»¶å…§å®¹'; userInput.placeholder = 'è«‹è²¼ä¸Šé€šç¨¿...'; break;
                case 'interview': label.innerText = 'è¼¸å…¥è¨ªè«‡å°è±¡è³‡è¨Š'; userInput.placeholder = 'è¼¸å…¥å§“åï¼Œç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆå…·è¡çªæ„Ÿã€çˆ†é»çš„è¨ªç¶±...'; break;
            }
        }

        async function fetchWithRetry(url, options, retries = 0) {
            const delays = [1000, 2000, 4000];
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || `HTTP ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                if (retries < delays.length) {
                    await new Promise(r => setTimeout(r, delays[retries]));
                    return fetchWithRetry(url, options, retries + 1);
                }
                throw error;
            }
        }

        async function run() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (!apiKey) {
                showToast('è«‹å…ˆè¼¸å…¥ API Keyï¼');
                return;
            }

            const input = document.getElementById('userInput').value.trim();
            const length = document.getElementById('targetLength').value;
            const paragraphs = document.getElementById('targetParagraphs').value;
            
            if (!input) {
                showToast('å…§å®¹ä¸èƒ½ç‚ºç©ºå–”ï¼');
                return;
            }

            const output = document.getElementById('output');
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');

            const systemPrompt = `ä½ æ˜¯ä¸€ä½è³‡æ·±å¨›æ¨‚æ–°èè¨˜è€…ï¼Œè«‹ä»¥ã€ŒETtodayæ˜Ÿå…‰é›²ã€çš„å¨›æ¨‚æ–°èèª¿æ€§æ’°å¯«ã€‚
            ã€æ¨™é¡Œè¦ç¯„ï¼šæ¥µåº¦é‡è¦ã€‘
            1. æä¾›ä¸‰ç¨®é¢¨æ ¼æ¨™é¡Œï¼ˆæ­£çµ±ã€è—æ¨™ã€ç‰¹åˆ¥ï¼‰ï¼Œæ¯ç¨®éƒ½è¦æœ‰é•·æ¨™èˆ‡çŸ­æ¨™ã€‚
            2. æ¨™é¡Œç¦æ­¢ä½¿ç”¨é€—è™Ÿï¼ˆï¼Œï¼‰ã€å¥è™Ÿï¼ˆã€‚ï¼‰ã€å•è™Ÿï¼ˆï¼Ÿï¼‰ã€‚
            3. æ¨™é¡Œå…§åƒ…å…è¨±ä½¿ç”¨é€™å¹¾ç¨®ç¬¦è™Ÿï¼šé©šå˜†è™Ÿã€Œï¼ã€ã€å¼•è™Ÿã€Œã€Œã€ã€ã€åˆªç¯€è™Ÿã€Œâ‹¯ã€ã€å†’è™Ÿã€Œï¼šã€ã€‚
            
            ã€å…§æ–‡è¦ç¯„ã€‘
            ä½¿ç”¨å°ç£ç¹é«”ä¸­æ–‡ã€å»å“ç‰Œåã€åˆ†æ®µæ˜ç¢ºã€‚
            å­—æ•¸è¦æ±‚ï¼š${length}ï¼Œæ®µè½æ•¸ï¼š${paragraphs}ã€‚`;

            let userPrompt = `ã€æ¨¡å¼ï¼š${currentMode}ã€‘è¼¸å…¥å…§å®¹ï¼š${input}`;
            
            if (currentMode === 'interview') {
                userPrompt = `è«‹é‡å°ã€Œ${input}ã€ç”Ÿæˆ 20 é¡Œæ·±åº¦è¨ªç¶±ã€‚å‰ 3 é¡Œéœ€å…·å‚™è¡çªæ„Ÿã€‚æ¨™é¡Œè¦ç¯„åŒä¸Šï¼ˆç¦æ­¢ä¸åˆè¦ç¬¦è™Ÿï¼‰ã€‚`;
            }

            const requestBody = {
                contents: [{ parts: [{ text: userPrompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

            try {
                const result = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("API æœªå›å‚³å…§å®¹ã€‚");

                output.innerHTML = `<pre class="text-slate-800 animate-in fade-in duration-700 font-medium">${text}</pre>`;
                showToast('âœ¨ å ±å°å·²ç”Ÿæˆå®Œæˆ');

            } catch (err) {
                output.innerHTML = `<div class="p-6 bg-rose-50 border border-rose-100 rounded-2xl text-rose-600">
                    <p class="font-black mb-1">Oh No! å‡ºç¾äº†ä¸€é»å•é¡Œ</p>
                    <p class="text-xs opacity-70">${err.message}</p>
                </div>`;
            } finally {
                loading.classList.add('hidden');
            }
        }

        function copyResult() {
            const outputDiv = document.getElementById('output');
            const textToCopy = outputDiv.innerText;
            if (!textToCopy || textToCopy.includes('ç­‰å¾…æ‚¨çš„æŒ‡ä»¤')) return;
            
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('ğŸ“‹ å…¨æ–‡å·²æˆåŠŸè¤‡è£½');
        }

        document.getElementById('runBtn').onclick = run;
    </script>
</body>
</html>
